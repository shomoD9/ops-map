# Opening

Ops Map is a Manifest V3 browser extension that replaces the default new-tab page with a compact operating board for active work. The system is built around fast orientation: opening a tab should immediately reveal campaign intent, active mission text, and executable projects without drag interactions, modal detours, or hidden layout state. The architecture is therefore biased toward deterministic structure and legibility instead of free-form visual manipulation.

The decisive architectural move in this generation is the fixed six-slot board. Earlier spatial behavior allowed flexible placement, but it also made overlap, clipping, and inconsistent reading order part of normal operation. The current board turns that open-ended canvas into a bounded surface with stable slots, fixed two-column rhythm, and predictable overflow through vertical scrolling. The visual layer then reinforces that stability with a bhadralok gothic palette: parchment-first surfaces, deep ink text that always sits darker than the canvas, softly irregular seam borders, and dramatic but controlled serif hierarchy for titles and editorial labels.

Persistence remains sync-first for the map itself. Core state is written to `chrome.storage.sync` when extension APIs are available, with local fallback when running outside full extension context. The extension also pins a stable public key in `manifest.json` so unpacked installs resolve to one extension ID and therefore one sync namespace across devices. Cross-browser transfer is intentionally explicit through export/import, and the codebase keeps separate scaffold modules for future device-preference and cloud-sync evolution without exposing those controls as first-class sidebar actions today.

# Ontology

The primary entity is the campaign. A campaign is a strategic container with identity, title, compatibility color, and mission continuity fields. In board mode, campaigns are treated as ordered records rather than positioned objects: legacy coordinate fields still exist in state for compatibility, but rendering no longer depends on x/y geometry. Campaigns carry two mission channels by design: `currentMission` for active direction, and `previousMission` for deliberately completed work.

The second core entity is the project. A project is either launchable or physical. Launchable projects hold a link and link type metadata so the system can normalize web and URI patterns; physical projects intentionally carry no launch link so real-world artifacts can live in the same map model without fake URLs. Projects can belong to multiple campaigns, which means a single project record can appear in more than one campaign card as a deliberate duplicate view.

A third entity is the board state snapshot itself. The state object is versioned and timestamped, with campaigns and projects as collections plus `updatedAt` for sync conflict avoidance in the UI subscription path. Around that state, transfer uses a versioned envelope with `format`, `version`, and `exportedAt` so import validation can fail safely before any mutation happens.

There is also a lightweight scaffolding layer for future concerns. `src/devicePrefs.js` preserves a per-device storage boundary, and `src/googleSync.js` preserves cloud-sync status and diagnostics contracts. In the current product surface these remain infrastructural extension points rather than active operator entities, but they keep boundaries clear for future capability growth.

# Geography

At the root, `manifest.json` defines extension identity, permissions, and the new-tab override. The pinned `key` is a structural artifact, not a cosmetic one: changing it creates a different extension ID and therefore a different `chrome.storage.sync` namespace. `newtab.html` is the single shell document. It defines the collapsible sidebar, primary creation actions, transfer actions, board mount point, panel mount point, and hidden import file input that keeps JSON import native without persistent UI clutter.

The main stylesheet lives in `styles/newtab.css`, and custom type assets live in `styles/fonts/`. The CSS file defines the design token system, sidebar collapse behavior, two-column board geometry, campaign card treatment, mission and project interaction states, and responsive adjustments for narrower viewports. Its current token set is intentionally contrast-disciplined: primary text and icon colors remain darker than every core background while interaction highlights stay in the same warm paper-and-ink family. The font files (`Newsreader` and `IBM Plex Sans` variants) are part of the architectural surface because they are loaded directly by the stylesheet and are essential to the editorial visual contract.

Application logic lives under `src/`. `src/model.js` is the domain core: it normalizes incoming payloads, enforces campaign/project invariants, and applies pure mutations for campaign/project/mission lifecycle operations. `src/layout.js` shapes normalized state into six render slots and campaign-to-project groupings for deterministic board rendering. `src/storage.js` handles map persistence and storage subscriptions. `src/transfer.js` owns export envelope generation, serialization, filename strategy, and strict import parsing. `src/main.js` is the integration runtime that wires DOM events, panel workflows, render cycles, and persistence scheduling.

Two additional modules remain deliberately separated even in their scaffold phase. `src/devicePrefs.js` defines the local-only preference boundary so machine-specific behavior can be reintroduced without polluting shared state contracts. `src/googleSync.js` defines availability, status, and diagnostics interfaces for future Google-backed sync flows. Product-facing documentation is held in `README.md`, while `docs/V1_SPEC.md` and `docs/VISION.md` capture implementation scope and longer-horizon direction.

# Flow

When a new tab opens, `newtab.html` loads `src/main.js`. Initialization reads shared state and local device scaffolding in parallel, normalizes state through `src/model.js`, sets the sidebar to collapsed by default, binds global interactions, and renders immediately without waiting for manual input. After boot, storage subscriptions keep multiple extension surfaces aligned; incoming remote state is normalized and applied only when its timestamp differs from the current in-memory state.

Rendering is deterministic. `src/layout.js` always returns exactly six slots, so the board shape is stable at every campaign count. Occupied slots render campaign cards; empty slots render explicit create affordances. Project grouping is membership-driven, so multi-campaign projects intentionally appear in each relevant card. Sidebar summary text is compact (`c`, `p`, `m`) for low visual load while still exposing full accessible labels.

Editing uses two channels based on complexity. Campaign names and current mission text are inline editable, with mission updates committing on blur. Mission lifecycle actions that affect history are intentionally separated into a small menu so completion (`currentMission` moves to `previousMission`) is explicit rather than accidental. Project creation and editing run through the panel workflow because mode, link semantics, and multi-campaign membership require structured controls.

Launching behavior is mode-aware. Launchable projects open their links, while physical projects show a local explanatory tooltip instead of attempting navigation. Right-click on a project remains a direct edit shortcut for fast operator flow. Campaign deletion cascades membership cleanup, and orphaned projects are removed by domain rule.

Transfer is explicit and defensive. Export builds a versioned JSON envelope and triggers a downloadable snapshot. Import reads file text, validates format/version/timestamp/shape, normalizes incoming state, and requires a replace-all confirmation that compares current and incoming entity counts before applying mutations. Device-specific scaffolding data is intentionally left out of export payloads, so transfers move map intent without coupling local machine behavior.

# Philosophy

The architecture chooses bounded clarity over maximal freedom. The six-slot board is a deliberate constraint that trades infinite-canvas expressiveness for predictable scanning, simpler interaction logic, and lower maintenance risk. This is not only a UI decision; it is a system contract that simplifies normalization, rendering, and cross-device consistency.

Separation of concerns is maintained as a practical engineering tool. Domain truth lives in `src/model.js`, view shaping in `src/layout.js`, integration wiring in `src/main.js`, persistence boundaries in `src/storage.js`, and transfer contracts in `src/transfer.js`. That decomposition lets visual redesigns move quickly without destabilizing mutation rules, and lets storage or sync strategy evolve without rewriting board behavior.

Recent evolution also reflects intentional subtraction. The active sidebar now focuses on creation and transfer essentials, while per-device routing and Google cloud-sync features remain as modular scaffolds rather than exposed controls. This keeps the current operator surface tight while preserving clear seams for future capability expansion. The result is a system that is constrained on purpose, comprehensible under load, and easier to evolve without accidental coupling.
