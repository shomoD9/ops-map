/*
This stylesheet defines Ops Map's editorial design system.
It exists separately from behavior code so typography, spacing, and visual hierarchy can evolve
without changing domain logic in JavaScript.
It styles the shell in `newtab.html` and class hooks emitted by `src/main.js`, now using a monochrome
off-white/black palette, Garamond typography, and hand-drawn-like campaign borders.
*/

:root {
  --font-heading: "Garamond", "EB Garamond", "Adobe Garamond Pro", "Times New Roman", serif;
  --font-body: "Garamond", "EB Garamond", "Adobe Garamond Pro", "Times New Roman", serif;

  --color-paper: #f8f8f6;
  --color-paper-alt: #f3f3f1;
  --color-surface: #f6f6f4;
  --color-ink: #121212;
  --color-ink-muted: #303030;
  --color-accent: #111111;
  --color-accent-soft: #ececea;
  --color-line: #161616;
  --color-line-strong: #111111;

  --radius-s: 4px;
  --radius-m: 6px;
  --radius-l: 8px;

  --space-1: 4px;
  --space-2: 8px;
  --space-3: 12px;
  --space-4: 16px;
  --space-5: 20px;
  --space-6: 28px;
  --space-7: 30px;
  --space-8: 8px;

  --sidebar-open-width: 236px;
  --sidebar-closed-width: 60px;
  --focus-ring: 2px solid rgba(0, 0, 0, 0.48);
}

* {
  box-sizing: border-box;
}

html,
body {
  width: 100%;
  height: 100%;
  margin: 0;
}

body {
  font-family: var(--font-body);
  font-weight: 400;
  font-size: 14px;
  line-height: 1.65;
  color: var(--color-ink);
  background: var(--color-paper);
  overflow: hidden;
}

#app-shell {
  width: 100%;
  height: 100%;
  /* Outer margins are intentionally minimal so the board uses the full new-tab viewport. */
  padding: 4px 8px 0;
  display: grid;
  grid-template-columns: var(--sidebar-open-width) minmax(0, 1fr);
  gap: 12px;
  position: relative;
}

body.is-sidebar-collapsed #app-shell {
  grid-template-columns: var(--sidebar-closed-width) minmax(0, 1fr);
}

/* Sidebar behaves like a quiet page margin rather than a control console. */
.side-bar {
  height: 100%;
  border-radius: var(--radius-l);
  border: 1px solid var(--color-line);
  background: var(--color-paper-alt);
  padding: var(--space-3);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  overflow: hidden;
}

.side-head {
  display: flex;
  align-items: flex-start;
  gap: var(--space-3);
}

.sidebar-toggle {
  width: 34px;
  min-width: 34px;
  height: 34px;
  border-radius: var(--radius-s);
  border: 1px solid var(--color-line-strong);
  background: transparent;
  color: var(--color-accent);
  font-family: var(--font-body);
  font-size: 0.88rem;
  font-weight: 600;
  line-height: 1;
  cursor: pointer;
}

.brand-block {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.brand-block h1 {
  margin: 0;
  font-family: var(--font-heading);
  font-size: 1.45rem;
  font-weight: 700;
  line-height: 1.08;
  color: var(--color-accent);
}

.brand-block p {
  margin: 0;
  color: var(--color-ink-muted);
  font-size: 0.82rem;
  line-height: 1.5;
}

.side-section {
  border: 1px solid var(--color-line);
  border-radius: var(--radius-m);
  background: rgba(255, 255, 255, 0.34);
  padding: 8px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.secondary-actions {
  margin-top: auto;
}

button {
  border: 1px solid var(--color-line-strong);
  border-radius: var(--radius-s);
  background: transparent;
  color: var(--color-ink);
  font-family: var(--font-body);
  font-size: 0.9rem;
  font-weight: 600;
  line-height: 1.4;
  padding: 7px 10px;
  cursor: pointer;
  transition: background-color 120ms ease, border-color 120ms ease, color 120ms ease;
}

/* Sidebar controls intentionally use a tighter scale than board controls. */
.side-bar button {
  font-size: 0.82rem;
  padding: 6px 8px;
}

button:hover:not(:disabled) {
  background: rgba(0, 0, 0, 0.06);
  border-color: rgba(0, 0, 0, 0.56);
}

button:active:not(:disabled) {
  background: rgba(0, 0, 0, 0.1);
}

button:disabled {
  cursor: not-allowed;
  opacity: 0.54;
}

button:focus-visible,
select:focus-visible,
input:focus-visible,
[contenteditable="true"]:focus-visible {
  outline: var(--focus-ring);
  outline-offset: 1px;
}

.device-pref-control {
  display: flex;
  flex-direction: column;
  gap: 5px;
  border: 1px solid var(--color-line);
  border-radius: var(--radius-s);
  background: rgba(255, 255, 255, 0.3);
  padding: 6px 8px;
}

.device-pref-control span {
  color: var(--color-ink-muted);
  font-size: 0.66rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.06em;
}

.device-pref-control select {
  width: 100%;
  border: 1px solid var(--color-line-strong);
  border-radius: var(--radius-s);
  padding: 6px 7px;
  font-family: var(--font-body);
  font-size: 0.78rem;
  font-weight: 500;
  color: var(--color-ink);
  background: rgba(255, 255, 255, 0.56);
}

body.is-sidebar-collapsed .side-bar {
  padding: var(--space-2);
  align-items: center;
}

body.is-sidebar-collapsed .brand-block,
body.is-sidebar-collapsed .side-section {
  display: none;
}

body.is-sidebar-collapsed .side-head {
  width: 100%;
  justify-content: center;
}

/* The board remains a six-section composition with generous page-like gutters. */
#canvas {
  height: 100%;
  min-height: 0;
  display: grid;
  /* The board is locked to exactly two columns, and additional rows scroll downward. */
  grid-template-columns: repeat(2, minmax(0, 1fr));
  grid-auto-rows: minmax(260px, 1fr);
  gap: 24px;
  overflow-x: hidden;
  overflow-y: auto;
  padding-right: 2px;
  padding-bottom: 2px;
}

.campaign-card {
  position: relative;
  border-radius: var(--radius-l);
  border: none;
  background: var(--color-surface);
  /* Slightly tighter top padding lifts content upward within each card. */
  padding: 12px 20px 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  min-height: 0;
}

/* We layer two slightly offset strokes so campaign cards read as hand-drawn outlines. */
.campaign-card::before,
.campaign-card::after {
  content: "";
  position: absolute;
  inset: 0;
  border: 2px solid var(--color-line-strong);
  border-radius: var(--radius-l);
  pointer-events: none;
}

.campaign-card::before {
  transform: translate(0.8px, -0.6px) rotate(-0.23deg);
}

.campaign-card::after {
  inset: 1px;
  transform: translate(-0.7px, 0.7px) rotate(0.2deg);
  opacity: 0.92;
}

.campaign-card > * {
  position: relative;
  z-index: 1;
}

.campaign-card-header {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto;
  align-items: start;
  gap: var(--space-3);
}

.campaign-title {
  margin: 0;
  padding: 0 2px;
  border-radius: var(--radius-s);
  font-family: var(--font-heading);
  font-size: 1.55rem;
  font-weight: 700;
  line-height: 1.1;
  color: var(--color-accent);
  user-select: text;
  cursor: text;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.campaign-title:focus {
  background: var(--color-accent-soft);
  outline: none;
  white-space: normal;
}

.campaign-header-actions {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.campaign-delete {
  font-size: 0.8rem;
  padding: 4px 9px;
}

.mission-block {
  border-radius: var(--radius-m);
  border: 1px solid var(--color-line);
  background: rgba(255, 255, 255, 0.35);
  padding: 6px 8px;
}

.mission-editor {
  margin-top: 0;
  min-height: 34px;
  max-height: 56px;
  overflow-y: auto;
  padding: 2px 4px;
  border-radius: var(--radius-s);
  outline: none;
  font-family: var(--font-body);
  font-size: 0.9rem;
  line-height: 1.45;
  color: var(--color-ink);
  user-select: text;
  cursor: text;
}

.mission-editor:focus {
  background: rgba(0, 0, 0, 0.08);
}

.mission-editor[data-empty="true"]::before {
  content: "What's the next mission?";
  color: var(--color-ink-muted);
}

.previous-mission {
  margin: 6px 0 0;
  font-size: 0.85rem;
  color: var(--color-ink-muted);
  line-height: 1.5;
}

.previous-mission strong {
  font-weight: 600;
}

.projects-block {
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-height: 0;
  /* Keep project content anchored toward the top rather than vertically centered in tall cards. */
  flex: 0 0 auto;
}

.projects-header {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: var(--space-2);
}

.projects-label {
  margin: 0;
  color: var(--color-accent);
  font-family: var(--font-body);
  font-size: 0.68rem;
  font-weight: 600;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

.projects-add-icon {
  width: 18px;
  min-width: 18px;
  height: 18px;
  padding: 0;
  border-color: var(--color-line-strong);
  color: var(--color-accent);
  background: rgba(255, 255, 255, 0.48);
  font-size: 0.8rem;
  font-weight: 600;
  line-height: 1;
}

.projects-list {
  min-height: 92px;
  flex: 0 0 auto;
  overflow-y: auto;
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 6px;
  align-content: start;
  padding-right: 2px;
  max-height: 118px;
}

.projects-empty {
  margin: 0;
  grid-column: 1 / -1;
  color: var(--color-ink-muted);
  font-size: 0.92rem;
  line-height: 1.55;
}

/* Each project entry stays compact and textual, with edit control nearby but not dominant. */
.campaign-project-row {
  position: relative;
}

.project-launch {
  position: relative;
  width: 100%;
  padding-right: 34px;
  text-align: left;
  font-size: 0.84rem;
  font-weight: 500;
  line-height: 1.35;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  background: rgba(255, 255, 255, 0.42);
}

.project-launch.is-physical {
  border-style: dashed;
}

.project-launch[data-tip-visible="true"]::after {
  content: attr(data-tip);
  position: absolute;
  left: 8px;
  top: calc(100% + 4px);
  border-radius: var(--radius-s);
  background: var(--color-accent);
  color: var(--color-paper);
  font-size: 0.72rem;
  font-weight: 500;
  line-height: 1.2;
  white-space: nowrap;
  padding: 5px 7px;
  pointer-events: none;
  z-index: 2;
}

.project-edit-icon {
  position: absolute;
  top: 50%;
  right: 7px;
  transform: translateY(-50%);
  width: 19px;
  min-width: 19px;
  height: 19px;
  padding: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-color: rgba(0, 0, 0, 0.36);
  color: var(--color-accent);
  background: rgba(255, 255, 255, 0.76);
}

.project-edit-icon:hover:not(:disabled) {
  background: rgba(0, 0, 0, 0.12);
  border-color: rgba(0, 0, 0, 0.5);
}

.project-edit-glyph {
  width: 10px;
  height: 10px;
  stroke: currentColor;
  fill: none;
  stroke-width: 1.4;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.campaign-slot-empty {
  border-style: none;
  background: rgba(255, 255, 255, 0.3);
  justify-content: center;
  align-items: flex-start;
}

.empty-slot-title {
  margin: 0;
  font-family: var(--font-heading);
  font-size: 1.5rem;
  font-weight: 700;
  line-height: 1.2;
  color: var(--color-accent);
}

.empty-slot-body {
  margin: 0;
  color: var(--color-ink-muted);
  font-size: 0.9rem;
  line-height: 1.6;
}

.empty-slot-create {
  margin-top: 2px;
}

/* Panel stays practical but inherits the same editorial rhythm as the board. */
#panel-root {
  position: absolute;
  z-index: 40;
  right: var(--space-4);
  bottom: var(--space-2);
  width: min(430px, calc(100% - 40px));
  border-radius: var(--radius-l);
  border: 1px solid var(--color-line-strong);
  background: var(--color-paper);
  padding: var(--space-4);
}

#panel-root[hidden] {
  display: none;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-3);
}

.panel-header h3 {
  margin: 0;
  font-family: var(--font-heading);
  font-size: 1.15rem;
  font-weight: 700;
  line-height: 1.25;
  color: var(--color-accent);
}

.panel-close {
  font-size: 0.84rem;
  padding: 6px 9px;
}

.panel-field {
  display: flex;
  flex-direction: column;
  gap: 5px;
  margin-bottom: var(--space-3);
}

.panel-field label {
  color: var(--color-ink-muted);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.07em;
}

.panel-field input,
.panel-field select,
.panel-field textarea {
  width: 100%;
  border: 1px solid var(--color-line-strong);
  border-radius: var(--radius-s);
  padding: 8px 10px;
  font-family: var(--font-body);
  font-size: 0.88rem;
  line-height: 1.5;
  color: var(--color-ink);
  background: rgba(255, 255, 255, 0.5);
}

.panel-field textarea {
  min-height: 74px;
  resize: vertical;
}

.panel-field small {
  color: var(--color-ink-muted);
  line-height: 1.5;
}

.checkbox-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(148px, 1fr));
  gap: 7px;
  max-height: 140px;
  overflow-y: auto;
  padding: 2px;
}

.checkbox-chip {
  display: flex;
  align-items: center;
  gap: 6px;
  border: 1px solid var(--color-line);
  border-radius: var(--radius-s);
  background: rgba(255, 255, 255, 0.45);
  padding: 5px 9px;
}

.checkbox-chip input {
  width: auto;
  margin: 0;
}

.helper-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.helper-row input {
  flex: 1;
}

.panel-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--space-2);
  margin-top: var(--space-3);
}

.panel-error {
  min-height: 18px;
  margin: 6px 0 0;
  color: #1d1d1d;
  font-size: 0.84rem;
  line-height: 1.45;
}

.panel-note {
  margin: 10px 0;
  color: var(--color-ink-muted);
  font-size: 0.82rem;
  line-height: 1.55;
}

.panel-warning {
  margin: 10px 0;
  border-radius: var(--radius-m);
  border: 1px solid rgba(0, 0, 0, 0.44);
  background: rgba(0, 0, 0, 0.05);
  padding: 10px 12px;
}

.panel-warning h4 {
  margin: 0;
  color: #1c1c1c;
  font-size: 0.9rem;
  line-height: 1.35;
}

.panel-warning p {
  margin: 7px 0 0;
  color: #222222;
  font-size: 0.84rem;
  line-height: 1.45;
}

.destructive-action {
  border-color: rgba(0, 0, 0, 0.6);
  color: #111111;
  background: rgba(0, 0, 0, 0.07);
}

.destructive-action:hover {
  background: rgba(0, 0, 0, 0.14);
}

@media (max-width: 1320px) {
  #canvas {
    gap: 20px;
  }
}

@media (max-width: 980px) {
  :root {
    --sidebar-open-width: 210px;
  }

  #app-shell {
    padding: 4px 6px 0;
    gap: var(--space-4);
  }

  .brand-block h1 {
    font-size: 1.25rem;
  }

  .brand-block p {
    font-size: 0.74rem;
  }

  .campaign-title {
    font-size: 1.35rem;
  }
}

@media (max-width: 760px) {
  :root {
    --sidebar-open-width: 180px;
  }

  #canvas {
    /* Keep two columns even on narrow widths so width behavior stays deterministic. */
    grid-template-columns: repeat(2, minmax(0, 1fr));
    grid-auto-rows: minmax(230px, 1fr);
    overflow-y: auto;
  }

  #panel-root {
    width: min(430px, calc(100% - 24px));
    right: var(--space-3);
    bottom: var(--space-3);
  }

  .projects-list {
    grid-template-columns: minmax(0, 1fr);
  }
}
